{"blocks":[{"id":"E7D4AAB9-D4A0-408D-92F9-7A3BA60975E0","type":"StartBlock","disabled":false,"name":"AppReloadFinished","displayName":"App Reload Finished","comment":"Trigger on webhook when reload fails","childId":"AA5F2D53-AFF0-427B-B88A-B6D01DACC635","inputs":[{"id":"run_mode","value":"webhook","type":"select","structure":{}},{"id":"datasourcetype_guid","value":"61a87510-c7a3-11ea-95da-0fb0c241e75c","type":"select","displayValue":"Qlik Cloud Services","structure":[]},{"id":"webhook_event_guid","value":"2ad48ec0-889f-11eb-91d9-d92131915ff0","type":"select","displayValue":"App Reload Finished","structure":[]},{"id":"webhook_param_4d669700-5ddb-11ec-b6db-59878ae0ea82","value":"data.status eq \"error\"","type":"string","structure":[],"lookupValues":[]},{"id":"test_payload","value":"{\n  \"data\": {\n    \"id\": \"example_94a789ad-d967-4049-8aaf-9abac267c222\",\n    \"name\": \"example_succesful reload test 2\",\n    \"size\": {\n      \"memory\": 330\n    },\n    \"errors\": [],\n    \"status\": \"ok\",\n    \"endTime\": \"2021-09-09T09:26:52.849Z\",\n    \"duration\": 395,\n    \"reloadId\": \"example_6139d35322f4b7b6f66b1444\",\n    \"warnings\": [],\n    \"peakMemoryBytes\": 3894208\n  },\n  \"source\": \"com.qlik/engine\",\n  \"eventId\": \"example_2f6517c2-388a-4e28-803e-7491a0185b86\",\n  \"eventTime\": \"2021-09-09T09:26:52Z\",\n  \"eventType\": \"com.qlik.v1.app.reload.finished\",\n  \"extensions\": {\n    \"userId\": \"example_BlVarUAUM9I0ei3MmKMejlDaF1sKPnN5\",\n    \"tenantId\": \"example_WL69WlNT4PRbwAA8EZ1sDblqjthluHL1\",\n    \"topLevelResourceId\": \"example_94a789ad-d967-4049-8aaf-9abac267c222\"\n  },\n  \"contentType\": \"application/json\",\n  \"eventTypeVersion\": \"1.0.0\",\n  \"cloudEventsVersion\": \"0.1\"\n}","type":"json","structure":[]},{"id":"webhook_documentation","value":null,"type":"string","structure":{}}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-67,"y":-197,"logo":"https://cdn.qlikcloud.com/automations/logos/a2649cabda63b339ebc68a0c8d028f08.png"},{"id":"D5DBFA1D-EDE3-45A9-AC79-40703C3B0A0C","type":"EndpointBlock","disabled":false,"name":"listReloads","displayName":"Qlik Cloud Services - List Reloads","comment":"Get reload history for the app that failed a reload","childId":"EF3473E4-CBD3-4D33-8616-14C7D47DA91F","inputs":[{"id":"f287df70-e713-11ea-b5c2-9fdc86b669cb","value":"{$.AppReloadFinished.extensions.topLevelResourceId}","type":"string","structure":[]}],"settings":[{"id":"maxitemcount","value":"","type":"string","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":{}},{"id":"cache","value":"0","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"both","isCollapsed":false},{"name":"yes","isCollapsed":false},{"name":"no","isCollapsed":false}],"x":202,"y":155,"datasourcetype_guid":"61a87510-c7a3-11ea-95da-0fb0c241e75c","endpoint_guid":"b3239a30-e713-11ea-be5a-1f4e73bc4bd3","endpoint_role":"list"},{"id":"EF3473E4-CBD3-4D33-8616-14C7D47DA91F","type":"FilterListBlock","disabled":false,"name":"filterList","displayName":"Filter over Qlik Cloud Services - List Reloads - Filter List","comment":"Filter list for all failed reloads for today","childId":"2ECE82CA-544E-4967-BDCE-1DA619F69C22","inputs":[{"id":"list","value":"{ $.listReloads }","type":"string","structure":[]},{"id":"conditions","value":{"mode":"all","conditions":[{"input1":"status","operator":"=","input2":"FAILED"},{"input1":"creationTime","operator":">=","input2":"{date: 'now'}"}]},"type":"custom","structure":[]}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-55,"y":85,"loopBlockId":null},{"id":"2ECE82CA-544E-4967-BDCE-1DA619F69C22","type":"IfElseBlock","disabled":false,"name":"condition","displayName":"Condition","comment":"Check if failed 2 or more times","childId":null,"inputs":[{"id":"conditions","value":{"mode":"all","conditions":[{"input1":"{count: {$.filterList}}","operator":">=","input2":"2"}]},"type":"custom","structure":{}}],"settings":[],"collapsed":[{"name":"both","isCollapsed":false},{"name":"yes","isCollapsed":false},{"name":"no","isCollapsed":false}],"x":202,"y":475,"childTrueId":"09978457-1B07-431D-9FC2-BEBCC53547A1","childFalseId":"F5333AE8-65EE-411A-83E2-B9814AF318DE"},{"id":"09978457-1B07-431D-9FC2-BEBCC53547A1","type":"EndpointBlock","disabled":true,"name":"SendMail","displayName":"Mail - Send Mail","comment":"If yes, send Mail","childId":null,"inputs":[{"id":"442845a0-cd00-11eb-9aa5-b966a68573b7","value":"some@email.com","type":"string","structure":[]},{"id":"543f08c0-cd00-11eb-b9c6-af8e23cc2439","value":null,"type":"string","structure":[]},{"id":"5cbdb1d0-cd00-11eb-8afd-ddd4ecc002ac","value":null,"type":"string","structure":[]},{"id":"72cad1e0-cd00-11eb-aa1b-3f42c1d22e38","value":"Failed reload, app:{$.GetAppInformation.info.attributes.name}","type":"string","structure":[]},{"id":"79af8c50-cd24-11eb-a019-dfdc9a7f7317","value":"8ca918e0-cd24-11eb-a713-779c5b59e5f7","type":"select","displayValue":"text","structure":[]},{"id":"7d225d00-cd00-11eb-8493-055760e8b45a","value":"{$.GetAppInformation.info.attributes.name} has failed!\n\nMore info:\nhttps://{if: { $.getCurrentTenantInfo.hostnames[1] } empty , $.getCurrentTenantInfo.hostnames[0], $.getCurrentTenantInfo.hostnames[1]}/item/{$.rawAPIRequest2.data[0].id}/history","type":"longtext","structure":[]},{"id":"bb841f10-3341-11ec-b9a3-9d6de0bb7866","value":null,"type":"custom","structure":[]}],"settings":[{"id":"datasource","value":null,"type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":53,"y":803,"datasourcetype_guid":"05407a80-ccfd-11eb-b098-7140f6ac27f4","endpoint_guid":"84a79bf0-ccff-11eb-a508-7d415a725ea7","endpoint_role":"create"},{"id":"F5333AE8-65EE-411A-83E2-B9814AF318DE","type":"SleepBlock","disabled":false,"name":"sleep","displayName":"Sleep","comment":"Sleep 5 minutes","childId":"B8B04E34-D202-42E5-A097-157DC7F96BF7","inputs":[{"id":"time","value":"300","type":"string","structure":{}}],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-67,"y":523},{"id":"B8B04E34-D202-42E5-A097-157DC7F96BF7","type":"SnippetBlock","disabled":false,"name":"DoReload","displayName":"Qlik Cloud Services - Do Reload","comment":"Try again","childId":null,"inputs":[{"id":"29603390-e716-11ea-9e37-05e08ee32111","value":"{$.AppReloadFinished.extensions.topLevelResourceId}","type":"string","structure":{}},{"id":"2ac9eef0-a677-11eb-aacc-8b755d0fe484","value":"Start reload and continue","type":"select","displayValue":"Start reload and continue","structure":{}},{"id":"6892c0c0-c795-11eb-9860-9dc8cb705e25","value":null,"type":"select","structure":{}},{"id":"ecebf340-c797-11eb-8671-53658babb1a1","value":null,"type":"select","structure":{}}],"settings":[{"id":"blendr_on_error","value":"stop","type":"select","structure":{}},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-392,"y":71,"datasourcetype_guid":"61a87510-c7a3-11ea-95da-0fb0c241e75c","snippet_guid":"b5dbb7a0-e715-11ea-b2bf-43bb35adee19"},{"id":"29258CDC-9AA6-4B8C-9B4A-AB2CDCF64B72","type":"SnippetBlock","disabled":false,"name":"GetAppInformation","displayName":"Qlik Cloud Services - Get App Information","comment":"","childId":"692D10ED-B2B5-42C8-8706-3F5614188F7E","inputs":[{"id":"d3acbdc0-a8d2-11eb-8827-056900eab788","value":"{$.AppReloadFinished.extensions.topLevelResourceId}","type":"string","structure":{}}],"settings":[{"id":"blendr_on_error","value":"stop","type":"select","structure":{}},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":72,"y":95,"datasourcetype_guid":"61a87510-c7a3-11ea-95da-0fb0c241e75c","snippet_guid":"d3a8d4f0-a8d2-11eb-a81d-ffabb68491fb"},{"id":"AA5F2D53-AFF0-427B-B88A-B6D01DACC635","type":"EndpointBlock","disabled":false,"name":"getCurrentTenantInfo","displayName":"Qlik Cloud Services - Get Current Tenant Info","comment":"","childId":"29258CDC-9AA6-4B8C-9B4A-AB2CDCF64B72","inputs":[],"settings":[{"id":"blendr_on_error","value":"stop","type":"select","structure":{}},{"id":"cache","value":"0","type":"select","structure":{}},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-325,"y":-103,"datasourcetype_guid":"61a87510-c7a3-11ea-95da-0fb0c241e75c","endpoint_guid":"55051480-cb86-11ec-b746-892c1d04114e","endpoint_role":"get"},{"id":"692D10ED-B2B5-42C8-8706-3F5614188F7E","type":"EndpointBlock","disabled":false,"name":"rawAPIRequest2","displayName":"Qlik Cloud Services - Raw API Request 2","comment":"Retrieve the tags from the app by fetching the item","childId":"D5DBFA1D-EDE3-45A9-AC79-40703C3B0A0C","inputs":[{"id":"4add8960-2078-11ec-be2c-7fc55d771fe6","value":"items","type":"string","structure":[]},{"id":"3b992a40-2072-11ec-9f0e-ed01586a7e1b","value":"3ba1eed0-2072-11ec-aa67-f118ee53373a","type":"select","displayValue":"GET","structure":[]},{"id":"3b8b9090-2072-11ec-8c77-5195fbb0ca65","value":[],"type":"object","mode":"keyValue","structure":[]},{"id":"993585d0-2839-11ec-b431-df4deed6c1ae","value":[{"key":"resourceId","value":"{$.AppReloadFinished.extensions.topLevelResourceId}"},{"key":"resourceType","value":"app"}],"type":"object","mode":"keyValue","structure":[]}],"settings":[{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"cache","value":"0","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":380,"y":57,"datasourcetype_guid":"61a87510-c7a3-11ea-95da-0fb0c241e75c","endpoint_guid":"3b75dd80-2072-11ec-9043-3b2aff6123af","endpoint_role":"get"}],"variables":[{"guid":"7AF0BA5B-A35D-4234-B379-48A88C115DAA","name":"executions","type":"number"},{"guid":"749F5C99-BDF8-46C3-90E6-593DB6BDBB54","name":"timestamp","type":"number"},{"guid":"C1E1260F-0901-42E1-AC27-145E6305CBB1","name":"spaces","type":"list"},{"guid":"DDFA952F-AC74-44C3-B3BA-F7E287F08B0A","name":"space","type":"string"},{"guid":"5923533D-7C4D-4575-B9FA-BD6AEC0F5C2A","name":"spacekeyvalue","type":"object"},{"guid":"853DDA5D-98C6-4EF0-B747-959084ECFB38","name":"TestTabel","type":"table"},{"guid":"F21AC5BD-014A-4211-B765-FE593962B86D","name":"TestList","type":"list"}]}